local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- ==========================================
-- ลอจิกจัดการ Config (Save / Load)
-- ==========================================
local ConfigFolder = "MoMoHub_Data"
local ConfigFile = ConfigFolder .. "/Settings.json"

local DefaultConfig = {
    -- Player / System Settings
    WalkSpeed = 16,
    JumpPower = 50,
    AntiAFK = true,
    AutoSave = false,
    AutoLoad = false,

    -- Farming Settings (Multi-Select)
    RipenessSelect = {"Lush"},
    MutationSelect = {"Any"},
    VariantSelect = {"Any"},
    AutoHarvest = false,
    SeedSelect = {"Carrot"},
    PlantMode = "Random",
    AutoPlant = false,
    AutoSellDelay = "10",
    AutoSell = false,

    -- Shop Settings (Multi-Select)
    BuyMode = "Buy Best Seed",
    TargetBuySeed = {"Carrot Seed"},
    AutoBuySeeds = false,
    TargetBuyGear = {"Watering Can"},
    AutoBuyGears = false
}

local MoMoConfig = {}

if isfolder and not isfolder(ConfigFolder) then makefolder(ConfigFolder) end

local function LoadConfig()
    if isfile and isfile(ConfigFile) then
        local success, decoded = pcall(function() return HttpService:JSONDecode(readfile(ConfigFile)) end)
        if success and type(decoded) == "table" then
            for k, v in pairs(DefaultConfig) do
                if decoded[k] == nil then decoded[k] = v end
            end
            return decoded
        end
    end
    return DefaultConfig
end

local SavedData = LoadConfig()

if SavedData.AutoLoad then
    MoMoConfig = SavedData
else
    MoMoConfig = DefaultConfig
    MoMoConfig.AutoLoad = SavedData.AutoLoad 
    MoMoConfig.AutoSave = SavedData.AutoSave 
end

local function SaveConfig()
    if writefile then
        local success, encoded = pcall(function() return HttpService:JSONEncode(MoMoConfig) end)
        if success then writefile(ConfigFile, encoded) end
    end
end

local function CheckAndSave()
    if MoMoConfig.AutoSave then SaveConfig() end
end

-- ==========================================
-- Game Logic & Remote Events (Garden Horizons)
-- ==========================================
local clientPlants = workspace:WaitForChild("ClientPlants")
local harvestEvent = ReplicatedStorage:WaitForChild("RemoteEvents"):WaitForChild("HarvestFruit")
local plantEvent = ReplicatedStorage:WaitForChild("RemoteEvents"):WaitForChild("PlantSeed")
local purchaseEvent = ReplicatedStorage:WaitForChild("RemoteEvents"):WaitForChild("PurchaseShopItem")
local sellEvent = ReplicatedStorage:WaitForChild("RemoteEvents"):WaitForChild("SellItems")

local plotsFolder = workspace:WaitForChild("Plots")

local availableSeeds = {}
local modelsFolder = ReplicatedStorage:FindFirstChild("Plants") and ReplicatedStorage.Plants:FindFirstChild("Models")
if modelsFolder then
    for _, plantModel in ipairs(modelsFolder:GetChildren()) do table.insert(availableSeeds, plantModel.Name) end
else
    availableSeeds = {"Carrot", "Corn", "Tomato", "Mushroom"} 
end
table.sort(availableSeeds)

local seedShopData = {
    ["Carrot"] = { Name = "Carrot Seed", Price = 20, LayoutOrder = 10 },
    ["Corn"] = { Name = "Corn Seed", Price = 100, LayoutOrder = 20 },
    ["Onion"] = { Name = "Onion Seed", Price = 200, LayoutOrder = 30 },
    ["Strawberry"] = { Name = "Strawberry Seed", Price = 800, LayoutOrder = 40 },
    ["Mushroom"] = { Name = "Mushroom Seed", Price = 1500, LayoutOrder = 50 },
    ["Beetroot"] = { Name = "Beetroot Seed", Price = 2500, LayoutOrder = 60 },
    ["Tomato"] = { Name = "Tomato Seed", Price = 4000, LayoutOrder = 70 },
    ["Apple"] = { Name = "Apple Seed", Price = 7000, LayoutOrder = 80 },
    ["Rose"] = { Name = "Rose Seed", Price = 10000, LayoutOrder = 90 },
    ["Wheat"] = { Name = "Wheat Seed", Price = 12000, LayoutOrder = 100 },
    ["Banana"] = { Name = "Banana Seed", Price = 30000, LayoutOrder = 110 },
    ["Plum"] = { Name = "Plum Seed", Price = 60000, LayoutOrder = 120 },
    ["Potato"] = { Name = "Potato Seed", Price = 100000, LayoutOrder = 130 },
    ["Cabbage"] = { Name = "Cabbage Seed", Price = 150000, LayoutOrder = 140 },
    ["Cherry"] = { Name = "Cherry Seed", Price = 1000000, LayoutOrder = 150 }
}

local gearShopData = {
    ["Watering Can"] = { Name = "Watering Can", Price = 5000, LayoutOrder = 10 },
    ["Basic Sprinkler"] = { Name = "Basic Sprinkler", Price = 15000, LayoutOrder = 20 },
    ["Harvest Bell"] = { Name = "Harvest Bell", Price = 35000, LayoutOrder = 30 },
    ["Turbo Sprinkler"] = { Name = "Turbo Sprinkler", Price = 60000, LayoutOrder = 40 },
    ["Favorite Tool"] = { Name = "Favorite Tool", Price = 80000, LayoutOrder = 45 },
    ["Super Sprinkler"] = { Name = "Super Sprinkler", Price = 100000, LayoutOrder = 50 }
}

local seedDropdownList, sortedSeeds = {}, {}
for key, data in pairs(seedShopData) do table.insert(sortedSeeds, data) end
table.sort(sortedSeeds, function(a, b) return a.LayoutOrder < b.LayoutOrder end)
for _, data in ipairs(sortedSeeds) do table.insert(seedDropdownList, data.Name) end

local gearDropdownList, sortedGears = {}, {}
for key, data in pairs(gearShopData) do table.insert(sortedGears, data) end
table.sort(sortedGears, function(a, b) return a.LayoutOrder < b.LayoutOrder end)
for _, data in ipairs(sortedGears) do table.insert(gearDropdownList, data.Name) end

local function GetMyPlot()
    for _, plot in ipairs(plotsFolder:GetChildren()) do
        local ownerId = plot:GetAttribute("Owner") or plot:GetAttribute("OwnerUserId")
        if not ownerId and plot:FindFirstChild("Owner") then ownerId = plot.Owner.Value end
        if ownerId and tonumber(ownerId) == LocalPlayer.UserId then return plot end
    end
    return nil
end

local function GetRandomPositionInPart(part)
    local size = part.Size
    local randomX = (math.random() - 0.5) * size.X
    local randomZ = (math.random() - 0.5) * size.Z
    local localPos = Vector3.new(randomX, size.Y / 2, randomZ)
    return part.CFrame:PointToWorldSpace(localPos)
end

local function GetSeedStock(seedKey)
    local pGui = LocalPlayer:FindFirstChild("PlayerGui")
    local stockText = pGui and pGui:FindFirstChild("SeedShop") and pGui.SeedShop:FindFirstChild("Frame")
        and pGui.SeedShop.Frame:FindFirstChild("ScrollingFrame") and pGui.SeedShop.Frame.ScrollingFrame:FindFirstChild(seedKey)
        and pGui.SeedShop.Frame.ScrollingFrame[seedKey]:FindFirstChild("MainInfo") and pGui.SeedShop.Frame.ScrollingFrame[seedKey].MainInfo:FindFirstChild("StockText")
    if stockText then
        local txt = stockText.Text
        if string.upper(txt) == "NO STOCK" then return 0 end
        return tonumber(string.match(txt, "%d+")) or 0
    end
    return 0 
end

local function GetGearStock(gearKey)
    local pGui = LocalPlayer:FindFirstChild("PlayerGui")
    local stockText = pGui and pGui:FindFirstChild("GearShop") and pGui.GearShop:FindFirstChild("Frame")
        and pGui.GearShop.Frame:FindFirstChild("ScrollingFrame") and pGui.GearShop.Frame.ScrollingFrame:FindFirstChild(gearKey)
        and pGui.GearShop.Frame.ScrollingFrame[gearKey]:FindFirstChild("MainInfo") and pGui.GearShop.Frame.ScrollingFrame[gearKey].MainInfo:FindFirstChild("StockText")
    if stockText then
        local txt = stockText.Text
        if string.upper(txt) == "NO STOCK" then return 0 end
        return tonumber(string.match(txt, "%d+")) or 0
    end
    return 0 
end

local function ParseSelectionToTable(selection)
    if type(selection) == "string" then return { [selection] = true } end
    if type(selection) == "table" then
        if selection[1] then 
            local temp = {}
            for _, v in ipairs(selection) do temp[v] = true end
            return temp
        end
        return selection 
    end
    return {}
end

-- Farming Functions
local function DoAutoHarvest(targetRipeness, targetMutation, targetVariant)
    local ripTable = ParseSelectionToTable(targetRipeness)
    local mutTable = ParseSelectionToTable(targetMutation)
    local varTable = ParseSelectionToTable(targetVariant)

    for _, plant in ipairs(clientPlants:GetChildren()) do
        local fruits = {}
        for _, child in ipairs(plant:GetChildren()) do
            if string.find(string.lower(child.Name), "fruit") then table.insert(fruits, child) end
        end
        
        if #fruits > 0 then
            local plantUuid = plant:GetAttribute("Uuid") or plant:GetAttribute("UUID")
            if not plantUuid then continue end
            for _, fruit in ipairs(fruits) do
                local ripeness = fruit:GetAttribute("RipenessStage") or "Unripe"
                local mutation = fruit:GetAttribute("Mutation") or "None"
                local variant = fruit:GetAttribute("Variant") or "None"
                local anchorIndex = fruit:GetAttribute("GrowthAnchorIndex")

                if (ripTable["Any"] or ripTable[ripeness]) and (mutTable["Any"] or mutTable[mutation]) and (varTable["Any"] or varTable[variant]) then
                    local payload = { Uuid = plantUuid }
                    if anchorIndex then payload.GrowthAnchorIndex = anchorIndex end
                    harvestEvent:FireServer({ payload }) 
                    task.wait(0.05) 
                end
            end
        else
            local uuid = plant:GetAttribute("Uuid") or plant:GetAttribute("UUID")
            local ripeness = plant:GetAttribute("RipenessStage") or "Unripe"
            local mutation = plant:GetAttribute("Mutation") or "None"
            local variant = plant:GetAttribute("Variant") or "None"

            if uuid and (ripTable["Any"] or ripTable[ripeness]) and (mutTable["Any"] or mutTable[mutation]) and (varTable["Any"] or varTable[variant]) then
                harvestEvent:FireServer({ { Uuid = uuid } })
                task.wait(0.05) 
            end
        end
    end
end

local function DoAutoPlant(seedSelection, mode)
    local seedTable = ParseSelectionToTable(seedSelection)
    local selectedSeeds = {}
    for k, v in pairs(seedTable) do if v then table.insert(selectedSeeds, k) end end
    if #selectedSeeds == 0 then return end
    
    local seedName = selectedSeeds[math.random(1, #selectedSeeds)]

    local char = LocalPlayer.Character
    local humanoid = char and char:FindFirstChild("Humanoid")
    local backpack = LocalPlayer:FindFirstChild("Backpack")
    
    local targetSeedKeyword = seedName .. " Seed"
    local equippedTool = nil
    
    if char then
        for _, child in ipairs(char:GetChildren()) do
            if child:IsA("Tool") and string.find(child.Name, targetSeedKeyword) then equippedTool = child break end
        end
    end
    
    if not equippedTool and backpack and humanoid then
        local toolInBackpack = nil
        for _, child in ipairs(backpack:GetChildren()) do
            if child:IsA("Tool") and string.find(child.Name, targetSeedKeyword) then toolInBackpack = child break end
        end
        if toolInBackpack then humanoid:EquipTool(toolInBackpack) task.wait(0.2) equippedTool = toolInBackpack end
    end

    if not equippedTool then return end

    local pos = nil
    if mode == "Player Position" then
        if char and char:FindFirstChild("HumanoidRootPart") then pos = char.HumanoidRootPart.Position end
    elseif mode == "Random" then
        local myPlot = GetMyPlot()
        if myPlot and myPlot:FindFirstChild("PlantableArea") then
            local areas = myPlot.PlantableArea:GetChildren()
            local validParts = {}
            for _, p in ipairs(areas) do if p:IsA("BasePart") then table.insert(validParts, p) end end
            if #validParts > 0 then pos = GetRandomPositionInPart(validParts[math.random(1, #validParts)]) end
        end
    end

    if pos and seedName then pcall(function() plantEvent:InvokeServer(seedName, pos) end) end
end

local function DoAutoBuySeeds(mode, selectedSeedsData)
    local leaderstats = LocalPlayer:FindFirstChild("leaderstats")
    local shillings = leaderstats and leaderstats:FindFirstChild("Shillings")
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not shillings or not hrp then return end

    local seedShopStand = workspace:FindFirstChild("MapPhysical") and workspace.MapPhysical:FindFirstChild("Shops") and workspace.MapPhysical.Shops:FindFirstChild("Seed Shop")
    local originalCFrame = hrp.CFrame
    local hasTeleported = false

    local function CheckAndTeleport()
        if not hasTeleported and seedShopStand then
            hrp.CFrame = seedShopStand:IsA("Model") and seedShopStand:GetPivot() or seedShopStand.CFrame
            task.wait(0.5) 
            hasTeleported = true
        end
    end

    if mode == "Buy Best Seed" then
        for _, data in ipairs(sortedSeeds) do
            local seedKey = string.gsub(data.Name, " Seed", "")
            if shillings.Value >= data.Price and GetSeedStock(seedKey) > 0 then
                CheckAndTeleport()
                while MoMoConfig.AutoBuySeeds and shillings.Value >= data.Price and GetSeedStock(seedKey) > 0 do
                    pcall(function() purchaseEvent:InvokeServer("SeedShop", data.Name) end)
                    task.wait(0.1)
                end
            end
            if not MoMoConfig.AutoBuySeeds then break end
        end
    elseif mode == "Select Mode" then
        local selectionTable = ParseSelectionToTable(selectedSeedsData)
        for seedName, isSelected in pairs(selectionTable) do
            if isSelected then
                local price, seedKey = 0, string.gsub(seedName, " Seed", "")
                for _, data in ipairs(sortedSeeds) do if data.Name == seedName then price = data.Price break end end
                
                if shillings.Value >= price and GetSeedStock(seedKey) > 0 then
                    CheckAndTeleport()
                    while MoMoConfig.AutoBuySeeds and shillings.Value >= price and GetSeedStock(seedKey) > 0 do
                        pcall(function() purchaseEvent:InvokeServer("SeedShop", seedName) end)
                        task.wait(0.1) 
                    end
                end
            end
            if not MoMoConfig.AutoBuySeeds then break end
        end
    end
    if hasTeleported then hrp.CFrame = originalCFrame end
end

local function DoAutoBuyGears(selectedGearsData)
    local leaderstats = LocalPlayer:FindFirstChild("leaderstats")
    local shillings = leaderstats and leaderstats:FindFirstChild("Shillings")
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not shillings or not hrp then return end

    local gearShopStand = workspace:FindFirstChild("MapPhysical") and workspace.MapPhysical:FindFirstChild("Shops") and workspace.MapPhysical.Shops:FindFirstChild("Gear Shop")
    local originalCFrame = hrp.CFrame
    local hasTeleported = false

    local function CheckAndTeleport()
        if not hasTeleported and gearShopStand then
            hrp.CFrame = gearShopStand:IsA("Model") and gearShopStand:GetPivot() or gearShopStand.CFrame
            task.wait(0.5) 
            hasTeleported = true
        end
    end

    local selectionTable = ParseSelectionToTable(selectedGearsData)
    for gearName, isSelected in pairs(selectionTable) do
        if isSelected then
            local price = 0
            for _, data in ipairs(sortedGears) do if data.Name == gearName then price = data.Price break end end
            
            if shillings.Value >= price and GetGearStock(gearName) > 0 then
                CheckAndTeleport()
                while MoMoConfig.AutoBuyGears and shillings.Value >= price and GetGearStock(gearName) > 0 do
                    pcall(function() purchaseEvent:InvokeServer("GearShop", gearName) end)
                    task.wait(0.1) 
                end
            end
        end
        if not MoMoConfig.AutoBuyGears then break end
    end
    if hasTeleported then hrp.CFrame = originalCFrame end
end

-- ==========================================
-- เริ่มโหลด UI (x2zu Framework)
-- ==========================================
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/x2zu/OPEN-SOURCE-UI-ROBLOX/refs/heads/main/X2ZU%20UI%20ROBLOX%20OPEN%20SOURCE/DummyUi-leak-by-x2zu/fetching-main/Tools/Framework.luau"))()

local Window = Library:Window({
    Title = "MoMoHub",
    Desc = "Welcome to the best script hub",
    Icon = "badge-check",
    Theme = "Amethyst",
    Color = Color3.fromRGB(170, 0, 255), 
    Config = {
        Keybind = Enum.KeyCode.LeftControl,
        Size = UDim2.new(0, 500, 0, 450) 
    },
    CloseUIButton = { Enabled = false, Text = "" }
})

-- ==========================================
-- สร้างปุ่มเปิด/ปิดแบบลากได้ (Draggable Image Button)
-- ==========================================
local targetGui = (gethui and gethui()) or game:GetService("CoreGui") or Players.LocalPlayer:WaitForChild("PlayerGui")
local CustomGui = Instance.new("ScreenGui")
CustomGui.Name = "MoMoHubToggleUI"
CustomGui.ResetOnSpawn = false
CustomGui.Parent = targetGui

local ToggleBtn = Instance.new("ImageButton")
ToggleBtn.Name = "MoMoHubToggle"
ToggleBtn.Parent = CustomGui
ToggleBtn.Position = UDim2.new(0, 300, 0.5, -200) 
ToggleBtn.Size = UDim2.new(0, 50, 0, 50) 
ToggleBtn.BackgroundTransparency = 1 
ToggleBtn.Image = "rbxthumb://type=Asset&id=82100122245666&w=150&h=150"

local dragging, dragInput, dragStart, startPos

ToggleBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = ToggleBtn.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

ToggleBtn.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        ToggleBtn.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

local vim = game:GetService("VirtualInputManager")
local isClicking = false

ToggleBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        isClicking = true
    end
end)

ToggleBtn.InputChanged:Connect(function(input)
    if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) and dragging then
        isClicking = false 
    end
end)

ToggleBtn.InputEnded:Connect(function(input)
    if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) and isClicking then
        pcall(function()
            vim:SendKeyEvent(true, Enum.KeyCode.LeftControl, false, game)
            task.wait(0.05)
            vim:SendKeyEvent(false, Enum.KeyCode.LeftControl, false, game)
        end)
    end
end)

-- ==========================================
-- Tab 1: Farming
-- ==========================================
local FarmTab = Window:Tab({Title = "Farming", Icon = "star"}) do
    FarmTab:Section({Title = "Auto Harvest Settings"})
    FarmTab:Dropdown({ Title = "Ripeness Stage", Multi = true, List = {"Any", "Unripe", "Ripened", "Lush"}, Value = MoMoConfig.RipenessSelect, Callback = function(v) MoMoConfig.RipenessSelect = v CheckAndSave() end })
    FarmTab:Dropdown({ Title = "Mutation Effect", Multi = true, List = {"Any", "None", "Chilled", "Flooded", "Foggy", "Frostbit", "Galactic", "Meteoric", "Misty", "Muddy", "Sandy", "Shocked", "Snowy", "Soaked", "Starstruck", "Stormy", "Tidal"}, Value = MoMoConfig.MutationSelect, Callback = function(v) MoMoConfig.MutationSelect = v CheckAndSave() end })
    FarmTab:Dropdown({ Title = "Variant Effect", Multi = true, List = {"Any", "None", "Gold", "Silver"}, Value = MoMoConfig.VariantSelect, Callback = function(v) MoMoConfig.VariantSelect = v CheckAndSave() end })
    FarmTab:Toggle({ Title = "Enable Auto Harvest", Desc = "Harvests plants automatically", Value = MoMoConfig.AutoHarvest, Callback = function(v)
        MoMoConfig.AutoHarvest = v
        CheckAndSave()
        task.spawn(function()
            while MoMoConfig.AutoHarvest do
                DoAutoHarvest(MoMoConfig.RipenessSelect, MoMoConfig.MutationSelect, MoMoConfig.VariantSelect)
                task.wait(0.5) 
            end
        end)
    end })

    FarmTab:Section({Title = "Auto Plant Settings"})
    FarmTab:Dropdown({ Title = "Select Seed to Plant", Multi = true, List = availableSeeds, Value = MoMoConfig.SeedSelect, Callback = function(v) MoMoConfig.SeedSelect = v CheckAndSave() end })
    FarmTab:Dropdown({ Title = "Plant Mode", List = {"Random", "Player Position"}, Value = MoMoConfig.PlantMode, Callback = function(v) MoMoConfig.PlantMode = v CheckAndSave() end })
    FarmTab:Toggle({ Title = "Enable Auto Plant", Desc = "Plants seeds automatically", Value = MoMoConfig.AutoPlant, Callback = function(v)
        MoMoConfig.AutoPlant = v
        CheckAndSave()
        task.spawn(function()
            while MoMoConfig.AutoPlant do
                DoAutoPlant(MoMoConfig.SeedSelect, MoMoConfig.PlantMode)
                task.wait(0.3)
            end
        end)
    end })

    FarmTab:Section({Title = "Auto Sell Settings"})
    FarmTab:Textbox({ Title = "Sell Delay (Seconds)", Desc = "Time between selling items", Placeholder = "10", Value = MoMoConfig.AutoSellDelay, ClearTextOnFocus = false, Callback = function(v) MoMoConfig.AutoSellDelay = v CheckAndSave() end })
    FarmTab:Toggle({ Title = "Enable Auto Sell All", Desc = "Teleports & Sells items", Value = MoMoConfig.AutoSell, Callback = function(v)
        MoMoConfig.AutoSell = v
        CheckAndSave()
        task.spawn(function()
            while MoMoConfig.AutoSell do
                local delay = tonumber(MoMoConfig.AutoSellDelay) or 10
                delay = math.max(1, delay) 

                local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                local sellStand = workspace:FindFirstChild("MapPhysical") and workspace.MapPhysical:FindFirstChild("Shops") and workspace.MapPhysical.Shops:FindFirstChild("Sell Stand")

                if hrp and sellStand then
                    local originalCFrame = hrp.CFrame
                    hrp.CFrame = sellStand:IsA("Model") and sellStand:GetPivot() or sellStand.CFrame
                    task.wait(0.5) 
                    pcall(function() sellEvent:InvokeServer("SellAll") end)
                    task.wait(0.5) 
                    hrp.CFrame = originalCFrame
                else
                    pcall(function() sellEvent:InvokeServer("SellAll") end)
                end
                task.wait(delay)
            end
        end)
    end })
end
Window:Line()

-- ==========================================
-- Tab 2: Shop
-- ==========================================
local ShopTab = Window:Tab({Title = "Shop", Icon = "tag"}) do
    ShopTab:Section({Title = "Auto Buy Seeds"})
    ShopTab:Dropdown({ Title = "Buy Mode (Seeds)", List = {"Buy Best Seed", "Select Mode"}, Value = MoMoConfig.BuyMode, Callback = function(v) MoMoConfig.BuyMode = v CheckAndSave() end })
    ShopTab:Dropdown({ Title = "Select Seed(s) to Buy", Multi = true, List = seedDropdownList, Value = MoMoConfig.TargetBuySeed, Callback = function(v) MoMoConfig.TargetBuySeed = v CheckAndSave() end })
    ShopTab:Toggle({ Title = "Enable Auto Buy Seeds", Desc = "Buys seeds automatically", Value = MoMoConfig.AutoBuySeeds, Callback = function(v)
        MoMoConfig.AutoBuySeeds = v
        CheckAndSave()
        task.spawn(function()
            while MoMoConfig.AutoBuySeeds do
                DoAutoBuySeeds(MoMoConfig.BuyMode, MoMoConfig.TargetBuySeed)
                task.wait(1) 
            end
        end)
    end })

    ShopTab:Section({Title = "Auto Buy Gears"})
    ShopTab:Dropdown({ Title = "Select Gear(s) to Buy", Multi = true, List = gearDropdownList, Value = MoMoConfig.TargetBuyGear, Callback = function(v) MoMoConfig.TargetBuyGear = v CheckAndSave() end })
    ShopTab:Toggle({ Title = "Enable Auto Buy Gears", Desc = "Buys gears automatically", Value = MoMoConfig.AutoBuyGears, Callback = function(v)
        MoMoConfig.AutoBuyGears = v
        CheckAndSave()
        task.spawn(function()
            while MoMoConfig.AutoBuyGears do
                DoAutoBuyGears(MoMoConfig.TargetBuyGear)
                task.wait(1) 
            end
        end)
    end })
end
Window:Line()

-- ==========================================
-- Tab 3: Player
-- ==========================================
local PlayerTab = Window:Tab({Title = "Player", Icon = "user"}) do
    PlayerTab:Section({Title = "Local Player Settings"})

    PlayerTab:Slider({
        Title = "WalkSpeed",
        Min = 16,
        Max = 250,
        Rounding = 0,
        Value = MoMoConfig.WalkSpeed,
        Callback = function(speed)
            MoMoConfig.WalkSpeed = speed
            CheckAndSave()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid.WalkSpeed = speed
            end
        end
    })

    PlayerTab:Slider({
        Title = "JumpPower",
        Min = 50,
        Max = 300,
        Rounding = 0,
        Value = MoMoConfig.JumpPower,
        Callback = function(power)
            MoMoConfig.JumpPower = power
            CheckAndSave()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid.JumpPower = power
            end
        end
    })
end
Window:Line()

-- ==========================================
-- Tab 4: Settings
-- ==========================================
local SettingsTab = Window:Tab({Title = "Settings", Icon = "wrench"}) do
    SettingsTab:Section({Title = "General Settings"})

    SettingsTab:Button({
        Title = "Join Discord",
        Desc = "discord.gg/k2wdyy8QMN",
        Callback = function()
            if setclipboard then
                setclipboard("https://discord.gg/k2wdyy8QMN")
                Window:Notify({Title = "MoMoHub", Desc = "Discord link copied!", Time = 3})
            end
        end
    })

    local AntiAfkConnection
    SettingsTab:Toggle({
        Title = "Anti-AFK",
        Desc = "Prevent getting kicked for inactivity",
        Value = MoMoConfig.AntiAFK,
        Callback = function(State)
            MoMoConfig.AntiAFK = State
            CheckAndSave()
            
            if State then
                AntiAfkConnection = LocalPlayer.Idled:Connect(function()
                    VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
                    task.wait(1)
                    VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
                end)
            else
                if AntiAfkConnection then
                    AntiAfkConnection:Disconnect()
                    AntiAfkConnection = nil
                end
            end
        end
    })

    if MoMoConfig.AntiAFK then
        AntiAfkConnection = LocalPlayer.Idled:Connect(function()
            VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
            task.wait(1)
            VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
        end)
    end

    SettingsTab:Section({Title = "Config System"})

    SettingsTab:Toggle({
        Title = "Auto Save Config",
        Desc = "Automatically save settings when changed",
        Value = MoMoConfig.AutoSave,
        Callback = function(State)
            MoMoConfig.AutoSave = State
            if State then SaveConfig() Window:Notify({Title = "Config", Desc = "Auto Save Enabled", Time = 3})
            else SaveConfig() Window:Notify({Title = "Config", Desc = "Auto Save Disabled", Time = 3}) end
        end
    })

    SettingsTab:Toggle({
        Title = "Auto Load Config",
        Desc = "Load settings automatically on inject",
        Value = MoMoConfig.AutoLoad,
        Callback = function(State)
            MoMoConfig.AutoLoad = State
            SaveConfig() 
            if State then Window:Notify({Title = "Config", Desc = "Auto Load Enabled", Time = 3})
            else Window:Notify({Title = "Config", Desc = "Auto Load Disabled", Time = 3}) end
        end
    })
end

-- ==========================================
-- จบการทำงาน
-- ==========================================
Window:Notify({
    Title = "MoMoHub",
    Desc = "Loaded Successfully! " .. (MoMoConfig.AutoLoad and "[Config Applied]" or ""),
    Time = 4
})

-- เริ่มต้นระบบต่างๆ อัตโนมัติหากตั้งค่า AutoLoad ไว้
if MoMoConfig.AutoHarvest then task.spawn(function() while MoMoConfig.AutoHarvest do DoAutoHarvest(MoMoConfig.RipenessSelect, MoMoConfig.MutationSelect, MoMoConfig.VariantSelect) task.wait(0.5) end end) end
if MoMoConfig.AutoPlant then task.spawn(function() while MoMoConfig.AutoPlant do DoAutoPlant(MoMoConfig.SeedSelect, MoMoConfig.PlantMode) task.wait(0.3) end end) end
if MoMoConfig.AutoSell then task.spawn(function() while MoMoConfig.AutoSell do local delay = tonumber(MoMoConfig.AutoSellDelay) or 10 pcall(function() sellEvent:InvokeServer("SellAll") end) task.wait(delay) end end) end
if MoMoConfig.AutoBuySeeds then task.spawn(function() while MoMoConfig.AutoBuySeeds do DoAutoBuySeeds(MoMoConfig.BuyMode, MoMoConfig.TargetBuySeed) task.wait(1) end end) end
if MoMoConfig.AutoBuyGears then task.spawn(function() while MoMoConfig.AutoBuyGears do DoAutoBuyGears(MoMoConfig.TargetBuyGear) task.wait(1) end end) end
